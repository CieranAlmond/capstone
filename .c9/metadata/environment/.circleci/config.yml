{"filter":false,"title":"config.yml","tooltip":"/.circleci/config.yml","undoManager":{"mark":18,"position":18,"stack":[[{"start":{"row":0,"column":0},"end":{"row":157,"column":25},"action":"insert","lines":["version: 2.1","","orbs:","  aws-eks: circleci/aws-eks@1.0.3","  kubernetes: circleci/kubernetes@0.11.2","","executors:","  python:","    docker:","      - image: circleci/python:3.7.3-stretch","  aws:","    docker:","      - image: amazon/aws-cli","","jobs:","  lint:","    docker:","      - image: circleci/python:3.7.3-stretch","    steps:","      - checkout","      - restore_cache:","          keys:","            - v1-dependencies-{{ checksum \"requirements.txt\" }}","            - v1-dependencies-","      - run:","          name: install dependencies","          command: |","            python3 -m venv venv","            source venv/bin/activate","            make install","            ","      - save_cache:","          paths:","            - ./venv","          key: v1-dependencies-{{ checksum \"requirements.txt\" }}","","      - run:","          name: run lint","          command: |","            source venv/bin/activate","            make lint","  build-test-push:","    machine: true","    working_directory: ~/app","    steps:","      - checkout","      - run:","          name: Build, test and push docker image","          command: |","            docker login -u ${DOCKER_USERNAME} -p ${DOCKER_PWD}","            docker build -t melsayed7/aws-capstone -t melsayed7/aws-capstone:${CIRCLE_WORKFLOW_ID:0:7} .","            docker run -d --rm --name flaskapp -p 8000:8080 melsayed7/aws-capstone:${CIRCLE_WORKFLOW_ID:0:7}","            sleep 5","            docker container ls","            export url=\"http://localhost:8000\"","            export response=$(curl -s $url)","            echo \"This is response $response\"","            if [[ $response == *\"Moustafa\"* ]]; then","              docker stop flaskapp","            else","              docker stop flaskapp","              exit 1","            fi","            echo \"CIRCLE CI WORKFLOW ID ${CIRCLE_WORKFLOW_ID:0:7}\"","            docker push melsayed7/aws-capstone:${CIRCLE_WORKFLOW_ID:0:7}","            docker push melsayed7/aws-capstone:latest","  create-cluster:","    executor: aws-eks/python3","    parameters:","      cluster-name:","        description: |","          Name of the EKS cluster","        type: string","    steps:","      - run:","          name: Set var","          command: |","            curl \"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\" -o \"awscliv2.zip\"","            unzip awscliv2.zip","            sudo ./aws/install","            aws --version","            export clusters=$(aws eks list-clusters)","            if [[ $clusters == *\"<< parameters.cluster-name >>\"* ]]; then","              circleci-agent step halt","            fi","      - aws-eks/create-cluster:","          cluster-name: << parameters.cluster-name >>","","  create-deployment:","    executor: aws-eks/python3","    parameters:","      cluster-name:","        description: |","          Name of the EKS cluster","        type: string","","    steps:","      - checkout","      - kubernetes/install","      - aws-eks/update-kubeconfig-with-authenticator:","          cluster-name: << parameters.cluster-name >>","          install-kubectl: true","      - kubernetes/create-or-update-resource:","          get-rollout-status: true","          resource-file-path: deployment.yml","          resource-name: deployment/aws-capstone","","  test-cluster:","    executor: aws-eks/python3","    parameters:","      cluster-name:","        description: |","          Name of the EKS cluster","        type: string","    steps:","      - kubernetes/install","      - aws-eks/update-kubeconfig-with-authenticator:","          cluster-name: << parameters.cluster-name >>","      - run:","          name: Test cluster","          command: |","            kubectl get svc","            kubectl get nodes","            kubectl get deployment","workflows:","  capstone:","    jobs:","      - lint","      - build-test-push:","          requires:","            - lint","      - create-cluster:","          cluster-name:  devops-capstone-project","          requires:","            - build-test-push","","      - create-deployment:","          cluster-name:  devops-capstone-project","          requires:","            - create-cluster","","      - aws-eks/update-container-image:","          cluster-name: devops-capstone-project","          container-image-updates: 'aws-capstone=melsayed7/aws-capstone:${CIRCLE_WORKFLOW_ID:0:7}'","          get-rollout-status: true","          record: true","          requires:","            - create-deployment","          resource-name:  deployment/aws-capstone","","      - test-cluster:","          cluster-name:  devops-capstone-project","          requires:","            - aws-eks/update-container-image","      - aws-eks/delete-cluster:","         cluster-name:  devops-capstone-project","         requires:","           - test-cluster"],"id":1}],[{"start":{"row":40,"column":21},"end":{"row":41,"column":0},"action":"insert","lines":["",""],"id":2},{"start":{"row":41,"column":0},"end":{"row":41,"column":12},"action":"insert","lines":["            "]}],[{"start":{"row":51,"column":28},"end":{"row":51,"column":50},"action":"remove","lines":["melsayed7/aws-capstone"],"id":4},{"start":{"row":51,"column":28},"end":{"row":53,"column":9},"action":"insert","lines":["kibnov","/","container"]}],[{"start":{"row":52,"column":1},"end":{"row":53,"column":0},"action":"remove","lines":["",""],"id":5}],[{"start":{"row":51,"column":34},"end":{"row":52,"column":0},"action":"remove","lines":["",""],"id":6}],[{"start":{"row":51,"column":48},"end":{"row":51,"column":70},"action":"remove","lines":["melsayed7/aws-capstone"],"id":7},{"start":{"row":51,"column":48},"end":{"row":53,"column":9},"action":"insert","lines":["kibnov","/","container"]}],[{"start":{"row":51,"column":54},"end":{"row":52,"column":0},"action":"remove","lines":["",""],"id":8}],[{"start":{"row":51,"column":55},"end":{"row":52,"column":0},"action":"remove","lines":["",""],"id":9}],[{"start":{"row":52,"column":60},"end":{"row":52,"column":82},"action":"remove","lines":["melsayed7/aws-capstone"],"id":10},{"start":{"row":52,"column":60},"end":{"row":52,"column":76},"action":"insert","lines":["kibnov/container"]}],[{"start":{"row":58,"column":33},"end":{"row":58,"column":41},"action":"remove","lines":["Moustafa"],"id":11},{"start":{"row":58,"column":33},"end":{"row":58,"column":34},"action":"insert","lines":["C"]},{"start":{"row":58,"column":34},"end":{"row":58,"column":35},"action":"insert","lines":["i"]},{"start":{"row":58,"column":35},"end":{"row":58,"column":36},"action":"insert","lines":["e"]},{"start":{"row":58,"column":36},"end":{"row":58,"column":37},"action":"insert","lines":["r"]},{"start":{"row":58,"column":37},"end":{"row":58,"column":38},"action":"insert","lines":["a"]},{"start":{"row":58,"column":38},"end":{"row":58,"column":39},"action":"insert","lines":["n"]}],[{"start":{"row":65,"column":24},"end":{"row":65,"column":46},"action":"remove","lines":["melsayed7/aws-capstone"],"id":12},{"start":{"row":65,"column":24},"end":{"row":65,"column":40},"action":"insert","lines":["kibnov/container"]}],[{"start":{"row":66,"column":24},"end":{"row":66,"column":46},"action":"remove","lines":["melsayed7/aws-capstone"],"id":13},{"start":{"row":66,"column":24},"end":{"row":66,"column":40},"action":"insert","lines":["kibnov/container"]}],[{"start":{"row":66,"column":47},"end":{"row":67,"column":0},"action":"insert","lines":["",""],"id":19},{"start":{"row":67,"column":0},"end":{"row":67,"column":12},"action":"insert","lines":["            "]}],[{"start":{"row":67,"column":8},"end":{"row":67,"column":12},"action":"remove","lines":["    "],"id":20}],[{"start":{"row":145,"column":49},"end":{"row":145,"column":58},"action":"remove","lines":["melsayed7"],"id":22},{"start":{"row":145,"column":49},"end":{"row":145,"column":50},"action":"insert","lines":["k"]},{"start":{"row":145,"column":50},"end":{"row":145,"column":51},"action":"insert","lines":["i"]},{"start":{"row":145,"column":51},"end":{"row":145,"column":52},"action":"insert","lines":["v"]},{"start":{"row":145,"column":52},"end":{"row":145,"column":53},"action":"insert","lines":["n"]},{"start":{"row":145,"column":53},"end":{"row":145,"column":54},"action":"insert","lines":["o"]}],[{"start":{"row":145,"column":53},"end":{"row":145,"column":54},"action":"remove","lines":["o"],"id":23},{"start":{"row":145,"column":52},"end":{"row":145,"column":53},"action":"remove","lines":["n"]},{"start":{"row":145,"column":51},"end":{"row":145,"column":52},"action":"remove","lines":["v"]}],[{"start":{"row":145,"column":51},"end":{"row":145,"column":52},"action":"insert","lines":["b"],"id":24},{"start":{"row":145,"column":52},"end":{"row":145,"column":53},"action":"insert","lines":["n"]},{"start":{"row":145,"column":53},"end":{"row":145,"column":54},"action":"insert","lines":["o"]},{"start":{"row":145,"column":54},"end":{"row":145,"column":55},"action":"insert","lines":["c"]}],[{"start":{"row":145,"column":54},"end":{"row":145,"column":55},"action":"remove","lines":["c"],"id":25}],[{"start":{"row":145,"column":54},"end":{"row":145,"column":55},"action":"insert","lines":["v"],"id":26}]]},"ace":{"folds":[],"scrolltop":360,"scrollleft":0,"selection":{"start":{"row":148,"column":19},"end":{"row":148,"column":19},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":24,"state":"start","mode":"ace/mode/yaml"}},"timestamp":1630061368485,"hash":"b83a4696ab0305df9dfcb0bfeb05c9547b8d9a8d"}