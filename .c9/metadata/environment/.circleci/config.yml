{"filter":false,"title":"config.yml","tooltip":"/.circleci/config.yml","undoManager":{"mark":100,"position":100,"stack":[[{"start":{"row":47,"column":2},"end":{"row":47,"column":3},"action":"insert","lines":["#"],"id":280}],[{"start":{"row":48,"column":2},"end":{"row":48,"column":3},"action":"insert","lines":["#"],"id":281}],[{"start":{"row":49,"column":2},"end":{"row":49,"column":3},"action":"insert","lines":["#"],"id":282}],[{"start":{"row":50,"column":2},"end":{"row":50,"column":3},"action":"insert","lines":["#"],"id":283}],[{"start":{"row":52,"column":2},"end":{"row":52,"column":3},"action":"insert","lines":["#"],"id":284}],[{"start":{"row":53,"column":3},"end":{"row":53,"column":4},"action":"insert","lines":["#"],"id":285}],[{"start":{"row":54,"column":3},"end":{"row":54,"column":4},"action":"insert","lines":["#"],"id":286}],[{"start":{"row":53,"column":3},"end":{"row":53,"column":4},"action":"remove","lines":["#"],"id":288}],[{"start":{"row":53,"column":2},"end":{"row":53,"column":3},"action":"insert","lines":["#"],"id":289}],[{"start":{"row":54,"column":3},"end":{"row":54,"column":4},"action":"remove","lines":["#"],"id":290}],[{"start":{"row":54,"column":2},"end":{"row":54,"column":3},"action":"insert","lines":["#"],"id":291}],[{"start":{"row":57,"column":2},"end":{"row":57,"column":3},"action":"insert","lines":["#"],"id":292}],[{"start":{"row":58,"column":2},"end":{"row":58,"column":3},"action":"insert","lines":["#"],"id":293}],[{"start":{"row":59,"column":2},"end":{"row":59,"column":3},"action":"insert","lines":["#"],"id":294}],[{"start":{"row":60,"column":2},"end":{"row":60,"column":3},"action":"insert","lines":["#"],"id":295}],[{"start":{"row":61,"column":2},"end":{"row":61,"column":3},"action":"insert","lines":["#"],"id":296}],[{"start":{"row":62,"column":2},"end":{"row":62,"column":3},"action":"insert","lines":["#"],"id":297}],[{"start":{"row":63,"column":2},"end":{"row":63,"column":3},"action":"insert","lines":["#"],"id":298}],[{"start":{"row":64,"column":2},"end":{"row":64,"column":3},"action":"insert","lines":["#"],"id":299}],[{"start":{"row":65,"column":2},"end":{"row":65,"column":3},"action":"insert","lines":["#"],"id":300}],[{"start":{"row":66,"column":2},"end":{"row":66,"column":3},"action":"insert","lines":["#"],"id":301}],[{"start":{"row":69,"column":2},"end":{"row":69,"column":3},"action":"insert","lines":["#"],"id":307}],[{"start":{"row":70,"column":2},"end":{"row":70,"column":3},"action":"insert","lines":["#"],"id":308}],[{"start":{"row":71,"column":2},"end":{"row":71,"column":3},"action":"insert","lines":["#"],"id":309}],[{"start":{"row":72,"column":2},"end":{"row":72,"column":3},"action":"insert","lines":["#"],"id":310}],[{"start":{"row":73,"column":2},"end":{"row":73,"column":3},"action":"insert","lines":["#"],"id":311}],[{"start":{"row":73,"column":2},"end":{"row":73,"column":3},"action":"remove","lines":["#"],"id":312}],[{"start":{"row":72,"column":2},"end":{"row":72,"column":3},"action":"remove","lines":["#"],"id":313}],[{"start":{"row":71,"column":2},"end":{"row":71,"column":3},"action":"remove","lines":["#"],"id":314}],[{"start":{"row":70,"column":2},"end":{"row":70,"column":3},"action":"remove","lines":["#"],"id":315}],[{"start":{"row":69,"column":2},"end":{"row":69,"column":3},"action":"remove","lines":["#"],"id":316}],[{"start":{"row":54,"column":2},"end":{"row":54,"column":3},"action":"remove","lines":["#"],"id":317}],[{"start":{"row":53,"column":2},"end":{"row":53,"column":3},"action":"remove","lines":["#"],"id":318}],[{"start":{"row":52,"column":2},"end":{"row":52,"column":3},"action":"remove","lines":["#"],"id":319}],[{"start":{"row":50,"column":2},"end":{"row":50,"column":3},"action":"remove","lines":["#"],"id":320}],[{"start":{"row":49,"column":2},"end":{"row":49,"column":3},"action":"remove","lines":["#"],"id":321}],[{"start":{"row":48,"column":2},"end":{"row":48,"column":3},"action":"remove","lines":["#"],"id":322}],[{"start":{"row":47,"column":2},"end":{"row":47,"column":3},"action":"remove","lines":["#"],"id":323}],[{"start":{"row":46,"column":2},"end":{"row":46,"column":3},"action":"remove","lines":["#"],"id":324}],[{"start":{"row":45,"column":2},"end":{"row":45,"column":3},"action":"remove","lines":["#"],"id":325}],[{"start":{"row":44,"column":2},"end":{"row":44,"column":3},"action":"remove","lines":["#"],"id":326}],[{"start":{"row":43,"column":2},"end":{"row":43,"column":3},"action":"remove","lines":["#"],"id":327}],[{"start":{"row":57,"column":2},"end":{"row":57,"column":3},"action":"remove","lines":["#"],"id":328}],[{"start":{"row":58,"column":2},"end":{"row":58,"column":3},"action":"remove","lines":["#"],"id":329}],[{"start":{"row":59,"column":2},"end":{"row":59,"column":3},"action":"remove","lines":["#"],"id":330}],[{"start":{"row":60,"column":2},"end":{"row":60,"column":3},"action":"remove","lines":["#"],"id":331}],[{"start":{"row":61,"column":2},"end":{"row":61,"column":3},"action":"remove","lines":["#"],"id":332}],[{"start":{"row":62,"column":2},"end":{"row":62,"column":3},"action":"remove","lines":["#"],"id":333}],[{"start":{"row":63,"column":2},"end":{"row":63,"column":3},"action":"remove","lines":["#"],"id":334}],[{"start":{"row":64,"column":2},"end":{"row":64,"column":3},"action":"remove","lines":["#"],"id":335}],[{"start":{"row":65,"column":2},"end":{"row":65,"column":3},"action":"remove","lines":["#"],"id":336}],[{"start":{"row":66,"column":2},"end":{"row":66,"column":3},"action":"remove","lines":["#"],"id":337}],[{"start":{"row":72,"column":0},"end":{"row":72,"column":18},"action":"remove","lines":["            exit 0"],"id":338},{"start":{"row":71,"column":47},"end":{"row":72,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":57,"column":12},"end":{"row":72,"column":14},"action":"remove","lines":["docker container ls","            export url=\"http://localhost:8000\"","            export response=$(curl -s $url)","            echo \"This is response $response\"","            if [[ $response == *\"kibnov\"* ]]; then","              docker stop flaskapp","            else","              docker stop flaskapp","              exit 1","            fi","            ","            ","            echo \"CIRCLE CI WORKFLOW ID ${CIRCLE_WORKFLOW_ID:0:7}\"","            docker push kibnov/container:${CIRCLE_WORKFLOW_ID:0:7}","            docker push kibnov/container:latest","            fi"],"id":340},{"start":{"row":57,"column":10},"end":{"row":57,"column":12},"action":"remove","lines":["  "]},{"start":{"row":57,"column":8},"end":{"row":57,"column":10},"action":"remove","lines":["  "]},{"start":{"row":57,"column":6},"end":{"row":57,"column":8},"action":"remove","lines":["  "]},{"start":{"row":57,"column":4},"end":{"row":57,"column":6},"action":"remove","lines":["  "]},{"start":{"row":57,"column":2},"end":{"row":57,"column":4},"action":"remove","lines":["  "]},{"start":{"row":57,"column":0},"end":{"row":57,"column":2},"action":"remove","lines":["  "]},{"start":{"row":56,"column":12},"end":{"row":57,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":69,"column":93},"end":{"row":70,"column":0},"action":"insert","lines":["",""],"id":341},{"start":{"row":70,"column":0},"end":{"row":70,"column":12},"action":"insert","lines":["            "]}],[{"start":{"row":70,"column":12},"end":{"row":70,"column":19},"action":"insert","lines":["tar xvf"],"id":342}],[{"start":{"row":70,"column":19},"end":{"row":70,"column":20},"action":"insert","lines":[" "],"id":343}],[{"start":{"row":70,"column":20},"end":{"row":70,"column":32},"action":"insert","lines":["awscliv2.zip"],"id":344}],[{"start":{"row":70,"column":12},"end":{"row":70,"column":13},"action":"insert","lines":["#"],"id":345}],[{"start":{"row":70,"column":12},"end":{"row":70,"column":13},"action":"remove","lines":["#"],"id":346}],[{"start":{"row":70,"column":12},"end":{"row":70,"column":32},"action":"remove","lines":["tar xvf awscliv2.zip"],"id":347},{"start":{"row":70,"column":10},"end":{"row":70,"column":12},"action":"remove","lines":["  "]},{"start":{"row":70,"column":8},"end":{"row":70,"column":10},"action":"remove","lines":["  "]},{"start":{"row":70,"column":6},"end":{"row":70,"column":8},"action":"remove","lines":["  "]},{"start":{"row":70,"column":4},"end":{"row":70,"column":6},"action":"remove","lines":["  "]},{"start":{"row":70,"column":2},"end":{"row":70,"column":4},"action":"remove","lines":["  "]},{"start":{"row":70,"column":0},"end":{"row":70,"column":2},"action":"remove","lines":["  "]},{"start":{"row":69,"column":93},"end":{"row":70,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":70,"column":12},"end":{"row":71,"column":12},"action":"insert","lines":["tar xvf awscliv2.zip","            "],"id":348}],[{"start":{"row":70,"column":12},"end":{"row":70,"column":32},"action":"remove","lines":["tar xvf awscliv2.zip"],"id":349}],[{"start":{"row":70,"column":12},"end":{"row":70,"column":13},"action":"insert","lines":["g"],"id":350},{"start":{"row":70,"column":13},"end":{"row":70,"column":14},"action":"insert","lines":["u"]},{"start":{"row":70,"column":14},"end":{"row":70,"column":15},"action":"insert","lines":["n"]},{"start":{"row":70,"column":15},"end":{"row":70,"column":16},"action":"insert","lines":["z"]},{"start":{"row":70,"column":16},"end":{"row":70,"column":17},"action":"insert","lines":["u"]},{"start":{"row":70,"column":17},"end":{"row":70,"column":18},"action":"insert","lines":["p"]}],[{"start":{"row":70,"column":17},"end":{"row":70,"column":18},"action":"remove","lines":["p"],"id":351},{"start":{"row":70,"column":16},"end":{"row":70,"column":17},"action":"remove","lines":["u"]}],[{"start":{"row":70,"column":16},"end":{"row":70,"column":17},"action":"insert","lines":["i"],"id":352},{"start":{"row":70,"column":17},"end":{"row":70,"column":18},"action":"insert","lines":["p"]}],[{"start":{"row":70,"column":18},"end":{"row":70,"column":19},"action":"insert","lines":[" "],"id":353},{"start":{"row":70,"column":19},"end":{"row":70,"column":20},"action":"insert","lines":["a"]},{"start":{"row":70,"column":20},"end":{"row":70,"column":21},"action":"insert","lines":["w"]},{"start":{"row":70,"column":21},"end":{"row":70,"column":22},"action":"insert","lines":["s"]}],[{"start":{"row":70,"column":19},"end":{"row":70,"column":22},"action":"remove","lines":["aws"],"id":354},{"start":{"row":70,"column":19},"end":{"row":70,"column":27},"action":"insert","lines":["awscliv2"]}],[{"start":{"row":70,"column":27},"end":{"row":70,"column":28},"action":"insert","lines":["."],"id":355},{"start":{"row":70,"column":28},"end":{"row":70,"column":29},"action":"insert","lines":["z"]},{"start":{"row":70,"column":29},"end":{"row":70,"column":30},"action":"insert","lines":["i"]},{"start":{"row":70,"column":30},"end":{"row":70,"column":31},"action":"insert","lines":["p"]}],[{"start":{"row":70,"column":0},"end":{"row":70,"column":31},"action":"remove","lines":["            gunzip awscliv2.zip"],"id":356},{"start":{"row":69,"column":93},"end":{"row":70,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":76,"column":14},"end":{"row":77,"column":0},"action":"insert","lines":["",""],"id":357},{"start":{"row":77,"column":0},"end":{"row":77,"column":12},"action":"insert","lines":["            "]}],[{"start":{"row":73,"column":12},"end":{"row":79,"column":53},"action":"remove","lines":["export clusters=$(aws eks list-clusters)","            if [[ $clusters == *\"<< parameters.cluster-name >>\"* ]]; then","              circleci-agent step halt","            fi","            ","      - aws-eks/create-cluster:","          cluster-name: << parameters.cluster-name >>"],"id":359}],[{"start":{"row":72,"column":25},"end":{"row":73,"column":0},"action":"insert","lines":["",""],"id":360},{"start":{"row":73,"column":0},"end":{"row":73,"column":12},"action":"insert","lines":["            "]}],[{"start":{"row":73,"column":10},"end":{"row":73,"column":12},"action":"remove","lines":["  "],"id":361},{"start":{"row":73,"column":8},"end":{"row":73,"column":10},"action":"remove","lines":["  "]},{"start":{"row":73,"column":6},"end":{"row":73,"column":8},"action":"remove","lines":["  "]}],[{"start":{"row":73,"column":6},"end":{"row":74,"column":0},"action":"insert","lines":["",""],"id":362},{"start":{"row":74,"column":0},"end":{"row":74,"column":6},"action":"insert","lines":["      "]}],[{"start":{"row":74,"column":6},"end":{"row":75,"column":53},"action":"insert","lines":["- aws-eks/create-cluster:","          cluster-name: << parameters.cluster-name >>"],"id":363}],[{"start":{"row":61,"column":19},"end":{"row":62,"column":0},"action":"insert","lines":["",""],"id":365},{"start":{"row":62,"column":0},"end":{"row":62,"column":6},"action":"insert","lines":["      "]}],[{"start":{"row":62,"column":6},"end":{"row":62,"column":8},"action":"insert","lines":["  "],"id":366}],[{"start":{"row":62,"column":8},"end":{"row":62,"column":31},"action":"insert","lines":["--name udacity-capstone"],"id":367}],[{"start":{"row":62,"column":8},"end":{"row":62,"column":15},"action":"remove","lines":["--name "],"id":368}],[{"start":{"row":62,"column":6},"end":{"row":62,"column":8},"action":"remove","lines":["  "],"id":369},{"start":{"row":62,"column":4},"end":{"row":62,"column":6},"action":"remove","lines":["  "]},{"start":{"row":62,"column":2},"end":{"row":62,"column":4},"action":"remove","lines":["  "]},{"start":{"row":62,"column":0},"end":{"row":62,"column":2},"action":"remove","lines":["  "]},{"start":{"row":61,"column":19},"end":{"row":62,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":61,"column":19},"end":{"row":61,"column":20},"action":"insert","lines":[" "],"id":370}],[{"start":{"row":95,"column":36},"end":{"row":95,"column":48},"action":"remove","lines":["aws-capstone"],"id":371},{"start":{"row":95,"column":36},"end":{"row":95,"column":45},"action":"insert","lines":["container"]}],[{"start":{"row":56,"column":12},"end":{"row":58,"column":53},"action":"insert","lines":["echo \"CIRCLE CI WORKFLOW ID ${CIRCLE_WORKFLOW_ID:0:7}\"","            docker push melsayed7/aws-capstone:${CIRCLE_WORKFLOW_ID:0:7}","            docker push melsayed7/aws-capstone:latest"],"id":372}],[{"start":{"row":57,"column":34},"end":{"row":57,"column":46},"action":"remove","lines":["aws-capstone"],"id":373},{"start":{"row":57,"column":34},"end":{"row":57,"column":43},"action":"insert","lines":["container"]}],[{"start":{"row":58,"column":34},"end":{"row":58,"column":46},"action":"remove","lines":["aws-capstone"],"id":374},{"start":{"row":58,"column":34},"end":{"row":58,"column":43},"action":"insert","lines":["container"]}],[{"start":{"row":135,"column":36},"end":{"row":135,"column":48},"action":"remove","lines":["aws-capstone"],"id":375},{"start":{"row":135,"column":36},"end":{"row":135,"column":45},"action":"insert","lines":["container"]}],[{"start":{"row":135,"column":53},"end":{"row":135,"column":65},"action":"remove","lines":["aws-capstone"],"id":376},{"start":{"row":135,"column":53},"end":{"row":135,"column":62},"action":"insert","lines":["container"]}],[{"start":{"row":140,"column":37},"end":{"row":140,"column":49},"action":"remove","lines":["aws-capstone"],"id":377},{"start":{"row":140,"column":37},"end":{"row":140,"column":46},"action":"insert","lines":["container"]}],[{"start":{"row":63,"column":20},"end":{"row":63,"column":36},"action":"remove","lines":["udacity-capstone"],"id":378}],[{"start":{"row":57,"column":24},"end":{"row":57,"column":33},"action":"remove","lines":["melsayed7"],"id":379},{"start":{"row":57,"column":24},"end":{"row":57,"column":25},"action":"insert","lines":["k"]},{"start":{"row":57,"column":25},"end":{"row":57,"column":26},"action":"insert","lines":["i"]},{"start":{"row":57,"column":26},"end":{"row":57,"column":27},"action":"insert","lines":["b"]},{"start":{"row":57,"column":27},"end":{"row":57,"column":28},"action":"insert","lines":["n"]},{"start":{"row":57,"column":28},"end":{"row":57,"column":29},"action":"insert","lines":["o"]},{"start":{"row":57,"column":29},"end":{"row":57,"column":30},"action":"insert","lines":["v"]}],[{"start":{"row":58,"column":24},"end":{"row":58,"column":33},"action":"remove","lines":["melsayed7"],"id":380},{"start":{"row":58,"column":24},"end":{"row":58,"column":25},"action":"insert","lines":["k"]},{"start":{"row":58,"column":25},"end":{"row":58,"column":26},"action":"insert","lines":["i"]},{"start":{"row":58,"column":26},"end":{"row":58,"column":27},"action":"insert","lines":["b"]},{"start":{"row":58,"column":27},"end":{"row":58,"column":28},"action":"insert","lines":["n"]},{"start":{"row":58,"column":28},"end":{"row":58,"column":29},"action":"insert","lines":["o"]},{"start":{"row":58,"column":29},"end":{"row":58,"column":30},"action":"insert","lines":["v"]}],[{"start":{"row":0,"column":0},"end":{"row":149,"column":25},"action":"remove","lines":["version: 2.1","","orbs:","  aws-eks: circleci/aws-eks@1.0.3","  kubernetes: circleci/kubernetes@0.11.2","","executors:","  python:","    docker:","      - image: circleci/python:3.7.3-stretch","  aws:","    docker:","      - image: amazon/aws-cli","","jobs:","  lint:","    docker:","      - image: circleci/python:3.7.3-stretch","    steps:","      - checkout","      - restore_cache:","          keys:","            - v1-dependencies-{{ checksum \"requirements.txt\" }}","            - v1-dependencies-","      - run:","          name: install dependencies","          command: |","            python3 -m venv venv","            source venv/bin/activate","            make install","            ","      - save_cache:","          paths:","            - ./venv","          key: v1-dependencies-{{ checksum \"requirements.txt\" }}","","      - run:","          name: run lint","          command: |","            source venv/bin/activate","            make lint","            ","  ","  build-test-push:","    machine: true","    working_directory: ~/app","    steps:","      - checkout","      - run:","          name: Build, test and push docker image","          command: |","","            docker build -t kibnov/container -t kibnov/container:${CIRCLE_WORKFLOW_ID:0:7} .","            docker run -d --rm --name flaskapp -p 8000:8080 kibnov/container:${CIRCLE_WORKFLOW_ID:0:7}","            sleep 5","            ","            echo \"CIRCLE CI WORKFLOW ID ${CIRCLE_WORKFLOW_ID:0:7}\"","            docker push kibnov/container:${CIRCLE_WORKFLOW_ID:0:7}","            docker push kibnov/container:latest","          ","  create-cluster:","    executor: aws-eks/python3","    parameters:","      cluster-name: ","        description: |","          Name of the EKS cluster","        type: string","    steps:","      - run:","          name: Set var","          command: |","            curl \"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\" -o \"awscliv2.zip\"","            unzip awscliv2.zip","            sudo ./aws/install","            aws --version","      ","      - aws-eks/create-cluster:","          cluster-name: << parameters.cluster-name >>","            ","","  create-deployment:","    executor: aws-eks/python3","    parameters:","      cluster-name:","        description: |","          Name of the EKS cluster","        type: string","","    steps:","      - checkout","      - kubernetes/install","      - aws-eks/update-kubeconfig-with-authenticator:","          cluster-name: << parameters.cluster-name >>","          install-kubectl: true","      - kubernetes/create-or-update-resource:","          get-rollout-status: true","          resource-file-path: deployment.yml","          resource-name: deployment/container","","  test-cluster:","    executor: aws-eks/python3","    parameters:","      cluster-name:","        description: |","          Name of the EKS cluster","        type: string","    steps:","      - kubernetes/install","      - aws-eks/update-kubeconfig-with-authenticator:","          cluster-name: << parameters.cluster-name >>","      - run:","          name: Test cluster","          command: |","            kubectl get svc","            kubectl get nodes","            kubectl get deployment","workflows:","  capstone:","    jobs:","      - lint","      - build-test-push:","          requires:","            - lint","      - create-cluster:","          cluster-name:  devops-capstone-project","          requires:","            - build-test-push","","      - create-deployment:","          cluster-name:  devops-capstone-project","          requires:","            - create-cluster","","      - aws-eks/update-container-image:","          cluster-name: devops-capstone-project","          container-image-updates: 'container=kibnov/container:${CIRCLE_WORKFLOW_ID:0:7}'","          get-rollout-status: true","          record: true","          requires:","            - create-deployment","          resource-name:  deployment/container","","      - test-cluster:","          cluster-name:  devops-capstone-project","          requires:","            - aws-eks/update-container-image","      - aws-eks/delete-cluster:","         cluster-name:  devops-capstone-project","         requires:","           - test-cluster"],"id":381},{"start":{"row":0,"column":0},"end":{"row":160,"column":26},"action":"insert","lines":["version: 2.1","","orbs:","  aws-cli: circleci/aws-cli@1.4.0","  aws-eks: circleci/aws-eks@1.0.3","  kubernetes: circleci/kubernetes@0.11.2","","jobs:","","  linting-testing:","    docker:","      - image: python:3.7.3-stretch","    steps:","      - checkout","      - attach_workspace:","          at: .","","      # Download and cache dependencies","      - restore_cache:","          keys:","          - v1-dependencies-{{ checksum \"requirements.txt\" }}","          # fallback to using the latest cache if no exact match is found","          - v1-dependencies-","","      - run:","          name: install dependencies","          command: |","            python3 -m venv venv","            . venv/bin/activate","            make install","            # Install hadolint","            wget -O /bin/hadolint https://github.com/hadolint/hadolint/releases/download/v1.16.3/hadolint-Linux-x86_64 &&\\","                chmod +x /bin/hadolint","      - save_cache:","          paths:","            - ./venv","          key: v1-dependencies-{{ checksum \"requirements.txt\" }}","        ","      # run lints!","      - run:","          name: run lint","          command: |","            . venv/bin/activate","            make lint","      # run tests!","      - run:","          name: run tests","          command: |","            . venv/bin/activate","            make test","  build:","    executor: aws-cli/default","    steps:","      - checkout","      - aws-cli/setup","      - run: sudo apt-get update","      - run: sudo apt-get install -y python3-pip python-dev","      - run: sudo pip install --upgrade awscli","      - run: aws --version","","      - run:","          name: install kubectl","          command: |","            curl -o kubectl https://amazon-eks.s3.us-west-2.amazonaws.com/1.20.4/2021-04-12/bin/linux/amd64/kubectl","            chmod +x ./kubectl","            mkdir -p $HOME/bin && cp ./kubectl $HOME/bin/kubectl && export PATH=$PATH:$HOME/bin","            kubectl version --short --client","      - run:","          name: install eksctl","          command: |","             curl --silent --location \"https://github.com/weaveworks/eksctl/releases/latest/download/eksctl_$(uname -s)_amd64.tar.gz\" | tar xz -C /tmp","             sudo mv /tmp/eksctl /usr/local/bin","             kubectl version --short --client","      - run:","          name: login","          command: |","            aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin 035472407210.dkr.ecr.us-east-1.amazonaws.com","      - setup_remote_docker","","      - run:","          name: build docker","          command: |","            docker build -t udacity-capstone-project:${CIRCLE_WORKFLOW_ID:0:7} .","            docker images","      - run:","          name: Push docker to ECR","          command: |","            docker tag udacity-capstone-project:${CIRCLE_WORKFLOW_ID:0:7} 035472407210.dkr.ecr.us-east-1.amazonaws.com/udacity-capstone-project:latest","            docker push 035472407210.dkr.ecr.us-east-1.amazonaws.com/udacity-capstone-project:latest","      - run:","          name: Create EKS-Cluster","          command: |","            eksctl create cluster --name udacity-capstone --managed --node-type \"t2.small\" --nodes 2","  deployment:","    executor: aws-eks/python3","    parameters:","      cluster-name:","        description: |","          udacity-capstone","        type: string","    steps:","      - checkout","      - kubernetes/install","      - aws-eks/update-kubeconfig-with-authenticator:","          cluster-name: << parameters.cluster-name >>","          install-kubectl: true","      - kubernetes/create-or-update-resource:","          get-rollout-status: true","          resource-file-path: deployment/deployment.yml","          resource-name: deployment/capstone-deployment","","  test-cluster:","    executor: aws-eks/python3","    parameters:","      cluster-name:","        description: |","          udacity-capstone","        type: string","    steps:","      - kubernetes/install","      - aws-eks/update-kubeconfig-with-authenticator:","          cluster-name: << parameters.cluster-name >>","      - run:","          name: Test cluster","          command: |","            kubectl get svc","            kubectl get nodes","            kubectl get deployment","      ","workflows:","  default:","    jobs:","      - linting-testing","      - build:","          requires: ","            - linting-testing","      - deployment:","          cluster-name: udacity-capstone","          requires:","             - build","      #- aws-eks/update-container-image:","          #cluster-name: udacity-capstone","          #container-image-updates: capstone-backend=035472407210.dkr.ecr.us-east-1.amazonaws.com/udacity-capstone-project:latest","          #post-steps:","              #- kubernetes/delete-resource:","                  #resource-names: capstone-deployment","                  #resource-types: deployment","                  #wait: true","          #record: true","          #requires:","              #- deployment","          #resource-name: deployment/capstone-deployment","      - test-cluster:","          cluster-name: udacity-capstone","          requires:","              - deployment","              #- aws-eks/update-container-image","      - aws-eks/delete-cluster:","          cluster-name: udacity-capstone","          requires:","            - test-cluster"]}],[{"start":{"row":76,"column":51},"end":{"row":76,"column":55},"action":"remove","lines":["east"],"id":382},{"start":{"row":76,"column":51},"end":{"row":76,"column":52},"action":"insert","lines":["w"]},{"start":{"row":76,"column":52},"end":{"row":76,"column":53},"action":"insert","lines":["e"]},{"start":{"row":76,"column":53},"end":{"row":76,"column":54},"action":"insert","lines":["s"]},{"start":{"row":76,"column":54},"end":{"row":76,"column":55},"action":"insert","lines":["t"]}],[{"start":{"row":76,"column":56},"end":{"row":76,"column":57},"action":"remove","lines":["1"],"id":383},{"start":{"row":76,"column":56},"end":{"row":76,"column":57},"action":"insert","lines":["2"]}],[{"start":{"row":76,"column":84},"end":{"row":76,"column":87},"action":"remove","lines":["AWS"],"id":384},{"start":{"row":76,"column":84},"end":{"row":76,"column":85},"action":"insert","lines":["k"]},{"start":{"row":76,"column":85},"end":{"row":76,"column":86},"action":"insert","lines":["i"]},{"start":{"row":76,"column":86},"end":{"row":76,"column":87},"action":"insert","lines":["b"]},{"start":{"row":76,"column":87},"end":{"row":76,"column":88},"action":"insert","lines":["n"]},{"start":{"row":76,"column":88},"end":{"row":76,"column":89},"action":"insert","lines":["o"]},{"start":{"row":76,"column":89},"end":{"row":76,"column":90},"action":"insert","lines":["v"]}],[{"start":{"row":76,"column":108},"end":{"row":76,"column":152},"action":"remove","lines":["035472407210.dkr.ecr.us-east-1.amazonaws.com"],"id":385},{"start":{"row":76,"column":108},"end":{"row":76,"column":159},"action":"insert","lines":["186999742423.dkr.ecr.us-west-2.amazonaws.com/kibnov"]}],[{"start":{"row":76,"column":158},"end":{"row":76,"column":159},"action":"remove","lines":["v"],"id":386},{"start":{"row":76,"column":157},"end":{"row":76,"column":158},"action":"remove","lines":["o"]},{"start":{"row":76,"column":156},"end":{"row":76,"column":157},"action":"remove","lines":["n"]},{"start":{"row":76,"column":155},"end":{"row":76,"column":156},"action":"remove","lines":["b"]},{"start":{"row":76,"column":154},"end":{"row":76,"column":155},"action":"remove","lines":["i"]},{"start":{"row":76,"column":153},"end":{"row":76,"column":154},"action":"remove","lines":["k"]}],[{"start":{"row":76,"column":153},"end":{"row":76,"column":154},"action":"insert","lines":["k"],"id":387},{"start":{"row":76,"column":154},"end":{"row":76,"column":155},"action":"insert","lines":["i"]},{"start":{"row":76,"column":155},"end":{"row":76,"column":156},"action":"insert","lines":["b"]},{"start":{"row":76,"column":156},"end":{"row":76,"column":157},"action":"insert","lines":["n"]},{"start":{"row":76,"column":157},"end":{"row":76,"column":158},"action":"insert","lines":["o"]},{"start":{"row":76,"column":158},"end":{"row":76,"column":159},"action":"insert","lines":["v"]}],[{"start":{"row":87,"column":74},"end":{"row":87,"column":143},"action":"remove","lines":["035472407210.dkr.ecr.us-east-1.amazonaws.com/udacity-capstone-project"],"id":388},{"start":{"row":87,"column":74},"end":{"row":87,"column":125},"action":"insert","lines":["186999742423.dkr.ecr.us-west-2.amazonaws.com/kibnov"]}],[{"start":{"row":88,"column":24},"end":{"row":88,"column":93},"action":"remove","lines":["035472407210.dkr.ecr.us-east-1.amazonaws.com/udacity-capstone-project"],"id":394},{"start":{"row":88,"column":24},"end":{"row":88,"column":75},"action":"insert","lines":["186999742423.dkr.ecr.us-west-2.amazonaws.com/kibnov"]}]]},"ace":{"folds":[],"scrolltop":1065,"scrollleft":0,"selection":{"start":{"row":88,"column":75},"end":{"row":88,"column":75},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":75,"state":["mlStringPre",10],"mode":"ace/mode/yaml"}},"timestamp":1630231770907,"hash":"927543c6bfc8f8e8083403eb93cb5dd3e0afa4a0"}